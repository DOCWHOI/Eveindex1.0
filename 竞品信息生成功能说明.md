# 竞品信息生成功能说明

## 功能概述

本功能实现了从高风险数据管理页面的数据列表生成可编辑的竞品信息，并保存到数据库中供竞品信息管理页面查看和管理。

## 主要功能

### 1. 生成竞品信息
- 在高风险数据管理页面的数据列表中，每条数据都有"生成竞品信息"操作按钮
- 点击按钮后会弹出生成表单，系统会自动填充从原始数据提取的信息
- 用户可以编辑和确认信息后保存

### 2. 竞品信息管理
- 在竞品信息管理页面可以查看所有生成的竞品信息
- 支持编辑、删除、搜索和筛选功能
- 显示数据来源和统计信息

## 技术实现

### 后端实现

#### 1. 数据库结构
- 扩展了 `t_product` 表，添加了竞品信息相关字段：
  - `applicant_name`: 申请人名称
  - `brand_name`: 品牌名称（贸易名称）
  - `device_code`: 设备代码（如K编号、注册编号等）
  - `data_source`: 数据来源（从哪个高风险数据生成）
  - `source_data_id`: 原始数据ID（关联到原始高风险数据）
  - `risk_level`: 风险等级
  - `usage_scope`: 使用范围
  - `device_description`: 设备描述
  - `remarks`: 备注信息

#### 2. API接口
创建了 `ProductController` 提供以下接口：
- `GET /api/products` - 分页获取竞品信息列表
- `GET /api/products/{id}` - 获取竞品信息详情
- `POST /api/products` - 创建竞品信息
- `PUT /api/products/{id}` - 更新竞品信息
- `DELETE /api/products/{id}` - 删除竞品信息
- `POST /api/products/generate` - 从高风险数据生成竞品信息
- `POST /api/products/batch-generate` - 批量生成竞品信息
- `GET /api/products/statistics` - 获取竞品信息统计
- `GET /api/products/check-exists` - 检查竞品信息是否存在

#### 3. 业务逻辑
- `ProductService` 提供竞品信息的业务逻辑处理
- `ProductRepository` 提供数据访问层操作
- 支持防重复生成检查，避免同一数据生成多次

### 前端实现

#### 1. 组件修改
- **HighRiskDataTable.vue**: 添加了"生成竞品信息"按钮和生成表单模态框
- **CompetitorInfo.vue**: 更新为从Product API获取数据，兼容原有功能

#### 2. API接口
- 创建了 `product.ts` API文件，提供竞品信息相关的接口调用

#### 3. 数据映射
根据不同的高风险数据类型（device510k、recall、event、registration、guidance、customs），自动提取相应的字段信息：
- 设备名称
- 申请人名称  
- 品牌名称
- 设备代码
- 使用范围
- 设备描述

## 使用流程

### 1. 生成竞品信息
1. 进入"高风险数据管理"页面
2. 在数据列表中找到要生成竞品信息的数据行
3. 点击"生成竞品信息"按钮
4. 在弹出的表单中确认或编辑信息
5. 点击"确认生成"保存竞品信息

### 2. 查看和管理竞品信息
1. 进入"竞品信息管理"页面
2. 可以看到所有生成的竞品信息列表
3. 支持搜索、筛选、编辑和删除操作
4. 可以查看统计信息

## 数据库迁移

执行以下SQL脚本更新数据库结构：
```sql
-- 运行 V1.1__Add_Competitor_Info_Fields_To_Product.sql
-- 该脚本会为 t_product 表添加必要的字段和索引
```

## 注意事项

1. **防重复生成**: 系统会检查同一数据源和数据ID是否已经生成过竞品信息，避免重复生成
2. **数据兼容性**: 竞品信息管理页面保持了对原有API的兼容性，如果新API不可用会自动回退到原有API
3. **字段映射**: 不同类型的高风险数据会映射到不同的竞品信息字段，确保信息的准确性
4. **权限控制**: 建议根据实际需求添加适当的权限控制

## 扩展建议

1. 可以添加批量生成功能，一次性生成多条竞品信息
2. 可以添加竞品信息的分类和标签功能
3. 可以添加竞品信息的导入导出功能
4. 可以添加竞品信息的审核流程
