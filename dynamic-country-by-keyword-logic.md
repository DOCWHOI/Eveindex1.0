# 基于匹配关键词的动态国家下拉框

## 功能逻辑

国家/地区下拉框现在实现了智能的动态筛选逻辑：

### 📋 **核心逻辑**

1. **有选择匹配关键词时**：
   - 显示该关键词匹配数据中的所有国家
   - 例如：选择"FCC认证" → 显示包含"FCC认证"数据的所有国家

2. **匹配关键词为空时**：
   - 显示所有高风险数据的国家
   - 例如：没有选择关键词 → 显示所有高风险数据涉及的国家

### 🔄 **动态更新机制**

- **监听关键词变化**：使用Vue的`watch`监听`searchForm.matchedKeyword`
- **自动重新加载**：关键词变化时自动重新获取对应的国家选项
- **智能清空**：关键词变化时自动清空当前选择的国家（因为可选国家可能已变化）

### 🎯 **用户体验**

#### **Placeholder文本**
- 选择关键词时：`"FCC认证相关国家"`
- 未选择关键词：`"高风险数据国家"`

#### **选项显示**
- 动态显示对应场景下的国家
- 每个国家显示数据条数，如 "美国 (125)"
- 按数据量降序排序

## 实现细节

### 🔧 **前端实现**

#### 1. **动态加载函数**
```typescript
const loadCountryOptions = async (matchedKeyword?: string) => {
  if (matchedKeyword && matchedKeyword.trim()) {
    // 场景1：根据匹配关键词获取国家
    const response = await getCrawlerData({
      matchedKeyword: matchedKeyword,
      size: 1000,
      page: 0
    })
    // 统计该关键词下各国家的数据量
  } else {
    // 场景2：获取所有高风险数据的国家
    const response = await getHighRiskCountryDistribution()
  }
}
```

#### 2. **监听器**
```typescript
watch(() => searchForm.matchedKeyword, async (newKeyword, oldKeyword) => {
  if (newKeyword !== oldKeyword) {
    searchForm.country = undefined // 清空当前选择的国家
    await loadCountryOptions(newKeyword) // 重新加载国家选项
  }
})
```

#### 3. **动态Placeholder**
```vue
<a-select
  :placeholder="searchForm.matchedKeyword ? `${searchForm.matchedKeyword}相关国家` : '高风险数据国家'"
>
```

### 🎯 **使用场景示例**

#### **场景1：分析特定认证的国家分布**
```
1. 用户选择匹配关键词："CE认证"
2. 国家下拉框自动更新，显示：
   - 德国 (85)
   - 法国 (72)
   - 意大利 (45)
   - 荷兰 (38)
3. Placeholder显示："CE认证相关国家"
```

#### **场景2：查看所有高风险数据分布**
```
1. 用户清空匹配关键词
2. 国家下拉框自动更新，显示：
   - 美国 (450)
   - 中国 (320)
   - 欧盟 (280)
   - 日本 (200)
3. Placeholder显示："高风险数据国家"
```

### 📊 **数据流程**

#### **关键词匹配场景**
```
用户选择关键词 → watch触发 → loadCountryOptions(keyword) 
→ getCrawlerData({matchedKeyword}) → 统计各国家数据量 
→ 更新countryOptions → 用户看到相关国家
```

#### **高风险数据场景**
```
关键词为空 → loadCountryOptions() → getHighRiskCountryDistribution() 
→ 获取高风险国家统计 → 更新countryOptions → 用户看到高风险国家
```

### ⚡ **性能优化**

1. **智能缓存**：相同关键词的结果可以缓存
2. **防抖处理**：快速切换关键词时避免频繁请求
3. **错误降级**：API失败时回退到显示所有国家
4. **加载状态**：显示loading状态提升用户体验

### 🔧 **错误处理**

1. **API失败**：自动回退到显示所有国家
2. **数据为空**：显示空选项列表
3. **网络错误**：显示错误信息并提供重试机制

## 测试验证

### 🧪 **测试步骤**

1. **打开DataQuery页面**
2. **测试场景1**：
   - 选择匹配关键词（如"FCC认证"）
   - 观察国家下拉框是否更新为相关国家
   - 验证placeholder文本变化
3. **测试场景2**：
   - 清空匹配关键词
   - 观察国家下拉框是否显示高风险数据国家
   - 验证placeholder恢复为默认文本
4. **测试交互**：
   - 多次切换不同关键词
   - 验证国家选项是否正确更新
   - 验证选择的国家是否被正确清空

### ✅ **预期结果**

- ✅ 关键词变化时国家选项自动更新
- ✅ Placeholder文本动态显示当前模式
- ✅ 国家选项按数据量排序
- ✅ 切换关键词时自动清空已选国家
- ✅ 错误时有合理的降级处理

## 技术优势

### 🚀 **用户体验**
- **智能筛选**：根据用户意图动态显示相关国家
- **上下文感知**：Placeholder文本反映当前筛选模式
- **数据透明**：显示每个国家的具体数据量

### 🎯 **功能完整性**
- **双模式支持**：既支持关键词筛选，也支持高风险数据查看
- **无缝切换**：用户可以随时在两种模式间切换
- **数据一致性**：确保显示的国家与当前筛选条件匹配

### 🔧 **技术实现**
- **响应式设计**：使用Vue的响应式系统自动更新
- **性能优化**：合理的数据获取和缓存策略
- **错误处理**：完整的异常处理和降级机制

**功能已完成实现，可以进行测试验证！**








